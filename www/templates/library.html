<ion-view view-title="{{'LIBRARY_DASHBOARD.HEADER' | translate}}">
  <ion-nav-bar class="bar-stable">
    <!-- <ion-nav-back-button>
    </ion-nav-back-button> -->
    <ion-nav-buttons side="left">
      <button class="button button-icon button-clear ion-navicon menu-toggle" menu-toggle="left">
      </button>
    </ion-nav-buttons>
    <ion-nav-buttons side="right">
      <!-- <button class="button button-icon button-clear" ng-click="createNewProject()"><i class="fa fa-icon fa-upload"></i></button>&nbsp;&nbsp; -->
      <!-- <button class="button button-icon button-clear" ng-click="showDelete()"><i class="fa fa-icon fa-minus"></i></button>&nbsp;&nbsp; -->
    </ion-nav-buttons>
  </ion-nav-bar>
  <ion-content id="Library" scroll="true">
    <ion-refresher pulling-text="Pull to refresh..." on-refresh="refreshData()">
    </ion-refresher>
    <div class="search animated slideInDown">
      <label class="item item-input">
        <i class="icon ion-search placeholder-icon"></i> &nbsp;
        <input class="main-search" type="text" placeholder="{{'LIBRARY_DASHBOARD.SEARCH_PLACEHOLDER' | translate}}" ng-model="search.text" ng-change="searchFiles(search.text)">
      </label>
      <div class="filters">
        <i class="fa fa-times-circle placeholder-icon" ng-click="clearSearch()"></i>
        <!-- <i class="fa fa-filter" ng-model="showFilters" ng-click="toggleFilters()"></i> -->
      </div>
      <div class="search-results" ng-if="searchResults || searchResults.length > 0">
        <ion-content scroll="true">
          <!-- <div class="warning" ng-if="!searchResults || searchResults.length < 1">
            <h1>No search results.</h1>
          </div> -->
          <div class="list card" ng-repeat="item in searchResults track by $index">
            <div class="item item-avatar">
              <div class="favs-options">
                <i class="fa" ng-class="isFavFile(item) ? 'fa-star' : 'fa-star-o'" ng-click="toggleFav(item,isFavFile(item))"></i>
              </div>
              <i class="fa" ng-class="item.icon" aria-hidden="true"></i>
              <h2><a href="{{item.file._url}}" target="_blank">{{item.title}}</a>&nbsp;<i class="fa fa-pencil" ng-if="item.ACL.permissionsById[CurrentUser.id].write" ng-click="editFile(item.id)"></i></h2>
              <p>{{'MODIFIED' | translate }}: {{item.updatedAt | moment}}</p>
              <span class="tags">
                <span ng-repeat="tag in item.tags">
                    {{tag.title}}
                </span>
              </span>
              <div class="ratings">
                <div class="total-rating">
                  <i class="fa fa-star"></i>{{item.attributes.rating | number:0}}<sub> / {{item.attributes.rating_count}} {{'TOTAL_VOTES' | translate}}</sub>
                </div>
                <star-rating-comp show-half-stars="true" on-click="rateFile($event,item)"></star-rating-comp>
                <!-- <span>{{item.attributes.ratings.length}}</span> -->
              </div>
              <span class="shared-with">
                <span class="user" ng-repeat="item in item.members track by $index" ng-style="{'z-index':'{{$index*-1}}','margin-left':'-{{$index*5}}px'}">
                  <div class="image" ng-style="{'background-image':'url({{item.attributes.image._url || '../img/no-image.jpg'}})'}"></div>
                </span>
              <div class="popularity" ng-if="item.users_favorite.length > 0">
                <i class="fa fa-star-o" aria-hidden="true"></i>
                <span class="icon-count">{{item.users_favorite.length}}</span>
              </div>
              </span>
              <div class="share-options">
                <a href="{{item.file._url}}" download><i class="fa fa-download" ng-click="addToFavs(item.id)"></i></a>
              </div>
            </div>
            <div class="item item-body" ng-if="item.description">
              <p>{{item.description}}</p>
            </div>
          </div>
        </ion-content>
      </div>
    </div>
    <!-- <div class="filter-panel" ng-class="showFilters ? 'open':'close'" ng-show="showFilters">
      <i class="fa fa-retweet" ng-click=""></i>
      <i class="fa fa-calendar" ng-click=""></i>
      <div class="toggle" style="float:right">
        <md-switch ng-model="data.cb1" aria-label="Switch 1">
          Filter
        </md-switch>
      </div>
    </div> -->
    <!-- Upload -->
    <div class="list card upload-module">
      <div class="list" id="upload-container">
        <div class="item item-avatar">
          <i class="fa fa-folder" aria-hidden="true"></i>
          <h2>{{'UPLOAD' | translate }}</h2>
          <p>(png, jpg, gif, pdf, doc, docx, txt)</p>
          <!-- <p>Stats &amp; Quick Reference</p> -->
        </div>
        <div class="item item-avatar">
          <i class="fa fa-upload" ng-class="filestoupload ? 'green': 'blue'" ng-click="uploadFiles()"></i>
          <span class="file-input"><input ng-model="uploadfiles" type="file" accept="image/*,.pdf,.doc,.docx,.txt,.zip" id="upload" multiple onchange="angular.element(this).scope().fileNameChanged(this)"/></span>
          <!--  <div class="warning">
              <h1>Drop Files Here </h1>
            </div> -->
          <!-- <div class="chips">
              <md-chips ng-model="searchTags" name="tagName" readonly="false" md-removable="true" md-max-chips="10" placeholder="Add tag(s) here...">
                <md-chip-template>
                  <strong>{{$chip}}</strong>
                </md-chip-template>
              </md-chips>
            </div> -->
        </div>
        <div class="chip-container">
          <div class="experimental-chips">
            <i class="fa fa-tag"></i>
            <h4>{{'LIBRARY_DASHBOARD.TAGS' | translate }}</h4>
            <span class="instructions">{{'LIBRARY_DASHBOARD.TAGS_MESSAGE' | translate }}</span>
            <md-chips ng-model="searchTags" md-autocomplete-snap md-transform-chip="transformChip($chip)" md-require-match="false">
              <md-autocomplete md-selected-item="selectedItem" md-search-text="searchText" md-items="item in querySearch(searchText)" md-item-text="item.name" placeholder="{{'LIBRARY_DASHBOARD.SEARCH_NOC_CODES' | translate }}" md-menu-class="autocomplete-custom-template">
                <md-item-template>
                  <span class="item-title">
                      <i class="fa fa-search"></i>
                      <span> {{item.attributes.title}} </span>
                  </span>
                  <span class="item-metadata">
                      <span>
                        <span>{{'LIBRARY_DASHBOARD.NOC_CODE' | translate }}:<strong>{{item.attributes.code}}</strong></span>
                  </span>
                  <span>
                        <!-- <strong>{{item.forks}}</strong> -->
                      </span>
                  </span>
                </md-item-template>
                <span md-highlight-text="searchText">{{item.attributes.title}} :: {{item.attributes.code}}</span>
              </md-autocomplete>
              <md-chip-template>
                <span>
                    <strong>{{$chip.attributes.title}}</strong>
                    <em>({{$chip.attributes.code}})</em>
                  </span>
              </md-chip-template>
            </md-chips>
          </div>
        </div>
        <div class="button button-full button-balanced" ng-click="uploadFiles()">{{'UPLOAD' | translate }}</div>
      </div>
    </div>
    <div class="file-dashboard animated fadeIn">
      <div class="list card">
        <div class="item item-avatar">
          <i class="fa fa-star" aria-hidden="true"></i>
          <h2>{{'MY_FAVORITES' | translate }}</h2>
          <p><a href="/#/app/library/favs">{{'VIEW_ALL' | translate}}</a></p>
          <!-- <p>Stats &amp; Quick Reference</p> -->
        </div>
        <div class="warning" ng-if="!userFavFiles || userFavFiles.length < 1">
          <h1>{{'LIBRARY_DASHBOARD.NO_FAVS' | translate }}</h1>
        </div>
        <div class="item item-body" ng-repeat="item in userFavFiles">
          <i class="fa" ng-class="item.attributes.icon" aria-hidden="true"></i>&nbsp;
          <span><a href="{{item.attributes.file._url}}" target="_blank">{{item.attributes.title}}</a>&nbsp;<i class="fa fa-pencil" ng-if="item.attributes.ACL.permissionsById[CurrentUser.id].write" ng-click="editFile(item.id)"></i></span>
          <span class="modified">
                <span>{{'MODIFIED' | translate }}: {{item.updatedAt | moment}}</span>
          <div>{{'CREATED_BY' | translate }}: {{item.attributes.createdBy.email}}</div>
          </span>
          <span class="tags">
                <span ng-repeat="tag in item.attributes.tags">
                    {{tag.title}}
                </span>
          </span>
          <div class="ratings">
            <div class="total-rating">
              <i class="fa fa-star"></i>{{item.attributes.rating | number:0}}<sub> / {{item.attributes.rating_count}} {{'TOTAL_VOTES' | translate}}</sub>
            </div>
            <star-rating-comp show-half-stars="true" on-click="rateFile($event,item)"></star-rating-comp>
            <!-- <span>{{item.attributes.ratings.length}}</span> -->
          </div>
          <span class="user-file-options">
            <!-- <span class="shared-with">
                <span class="user" ng-repeat="item in item.atrubutes.members track by $index" ng-style="{'z-index':'{{$index*-1}}','margin-left':'-{{$index*5}}px'}">
                  <div class="image" ng-style="{'background-image':'url({{item.image._url}})'}"></div>
                </span>
          </span> -->
          <div class="favs-options">
            <i class="fa" ng-class="isFavFile(item) ? 'fa-star' : 'fa-star-o'" ng-click="toggleFav(item,isFavFile(item))"></i>
            <a href="{{item.attributes.file._url}}" download><i class="fa fa-download" aria-hidden="true"></i></a>
            <!-- <i class="fa fa-share"></i> -->
          </div>&nbsp;
          </span>
        </div>
      </div>
      <div class="list card my-uploads">
        <div class="item item-avatar">
          <i class="fa fa-folder" aria-hidden="true"></i>
          <h2>{{'LIBRARY_DASHBOARD.MY_UPLOADS' | translate }}</h2>
          <p>{{'LIBRARY_DASHBOARD.MOST_RECENT_UPLOADS' | translate }}</p>
          <!-- <p>Stats &amp; Quick Reference</p> -->
        </div>
        <div class="warning" ng-if="!userFiles || userFiles.length < 1">
          <h1>{{'LIBRARY_DASHBOARD.NO_UPLOADS' | translate }}</h1>
        </div>
        <div class="item item-body" ng-repeat="item in userFiles">
          <i class="fa" ng-class="item.attributes.icon" aria-hidden="true"></i> <span class="filename"><a href="{{item.attributes.file._url}}" target="_blank">{{item.attributes.title}}</a><i class="fa fa-pencil" ng-if="item.attributes.ACL.permissionsById[CurrentUser.id].write" ng-click="editFile(item.attributes.id)"></i></span>
          <span class="modified">
                <span>{{'MODIFIED' | translate }}: {{item.attributes.updatedAt | moment}}</span>
          </span>
          <span class="tags">
                <span ng-repeat="tag in item.attributes.tags">
                    {{tag.title}}
                </span>
          </span>
          <div class="ratings">
            <div class="total-rating">
              <i class="fa fa-star"></i>{{item.attributes.rating | number:0}}<sub> / {{item.attributes.rating_count}} {{'TOTAL_VOTES' | translate}}</sub>
            </div>
            <star-rating-comp show-half-stars="true" on-click="rateFile($event,item)"></star-rating-comp>
            <!-- <span>{{item.attributes.ratings.length}}</span> -->
          </div>
          <span class="user-file-options">
              <span class="shared-with">
                  <span class="user" ng-repeat="item in item.members track by $index" ng-style="{'z-index':'{{$index*-1}}','margin-left':'-{{$index*5}}px'}">
                    <div class="image" ng-style="{'background-image':'url({{item.attributes.image._url || '../img/no-image.jpg'}})'}"></div>
                  </span>
          </span>
          </span>
          <!-- <a class="download-button" href="{{item.file._url}}" download><i class="fa fa-download" aria-hidden="true"></i></a>&nbsp; -->
          <!-- <i class="fa fa-share-alt" aria-hidden="true"></i>&nbsp; -->
          <!-- <i class="fa fa-pencil" aria-hidden="true"></i>&nbsp; -->
          </span>
        </div>
      </div>
  </ion-content>
</ion-view>
